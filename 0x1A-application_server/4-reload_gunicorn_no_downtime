#!/bin/bash
# Reload Gunicorn gracefully without downtime

# Get the PID of the Gunicorn master process
GUNICORN_PID=$(ps aux | grep 'gunicorn' | grep 'master' | awk '{print $2}')

# Check if the Gunicorn master process is running
if [ -z "$GUNICORN_PID" ]; then
  echo "Gunicorn master process not found. Is Gunicorn running?"
  exit 1
fi

# Send the HUP signal to the Gunicorn master process to reload workers
echo "Reloading Gunicorn workers..."
kill -HUP "$GUNICORN_PID"

# Check if the reload was successful
if [ $? -eq 0 ]; then
  echo "Gunicorn workers reloaded successfully."
else
  echo "Failed to reload Gunicorn workers."
  exit 1
fi
